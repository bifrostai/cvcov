(function(n,i){typeof exports=="object"&&typeof module<"u"?i(require("@fiftyone/plugins"),require("@fiftyone/components"),require("@fiftyone/operators"),require("@fiftyone/state"),require("react"),require("recoil"),require("@mui/material")):typeof define=="function"&&define.amd?define(["@fiftyone/plugins","@fiftyone/components","@fiftyone/operators","@fiftyone/state","react","recoil","@mui/material"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.__fop__,n.__foc__,n.__foo__,n.__fos__,n.React,n.recoil,n.__mui__))})(this,function(n,i,a,B,c,v,e){"use strict";function P(s){const p=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const r in s)if(r!=="default"){const g=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(p,r,g.get?g:{enumerable:!0,get:()=>s[r]})}}return p.default=s,Object.freeze(p)}const h=P(B);function j(){var C,_;const[s,p]=c.useState(!0),r=v.useRecoilValue(h.dataset),g=v.useRecoilValue(h.filters),[R,k]=c.useState([]),[m,u]=c.useState(!1),[T,f]=c.useState({}),[l,S]=c.useState(null),b=a.useOperatorExecutor("@bifrostai/cvcov/compute_embeddings",{onSuccess:t=>{console.log("Embedding computation completed:",t),D.execute({})},onError:t=>{console.log("Embedding computation failed:",t),u(!1)}}),D=a.useOperatorExecutor("@bifrostai/cvcov/cluster_embeddings",{onSuccess:t=>{console.log("Clustering completed:",t),u(!1),f({}),S(t.result)},onError:t=>{console.log("Clustering failed:",t),u(!1)}}),d=a.useOperatorExecutor("@bifrostai/cvcov/fetch_annotations"),y=a.useOperatorExecutor("@bifrostai/cvcov/get_progress");return c.useEffect(()=>{r&&d.execute({})},[r,g]),c.useEffect(()=>{var t;(t=d.result)!=null&&t.annotations&&k(d.result.annotations)},[d.result]),c.useEffect(()=>{if(!m)return;const t=setInterval(()=>{y.execute({})},500);return()=>clearInterval(t)},[m]),c.useEffect(()=>{if(y.result){const t=y.result;if(t.active_operations){const o=t.active_operations,x={};for(const[E,O]of Object.entries(o))x[E]={progress:O.progress,label:O.label,operation:E};f(x),Object.values(x).some(E=>E.progress<1)||u(!1)}else t.progress!==void 0?(f({unknown:{progress:t.progress,label:t.label,operation:"unknown"}}),t.progress>=1&&u(!1)):(f({}),u(!1))}},[y.result]),React.createElement(e.Box,{sx:{p:2}},React.createElement(e.Typography,{variant:"h4",gutterBottom:!0},"Bifrost CVCov Plugin"),React.createElement(e.Typography,{variant:"body1",gutterBottom:!0},"Dataset: ",(r==null?void 0:r.name)||"No dataset loaded"),React.createElement(e.Box,{sx:{mt:2,mb:2}},React.createElement(e.Checkbox,{checked:s,onChange:()=>{p(!s)}}),React.createElement(e.Typography,{variant:"body2",display:"inline",sx:{ml:1}},"Debug mode")),React.createElement(i.Button,{variant:"contained",disabled:m,onClick:()=>{u(!0),f({}),b.execute({})}},m?"Processing...":"Compute Embeddings & Cluster"),Object.keys(T).length>0&&React.createElement(e.Box,{sx:{mt:2,mb:2}},Object.entries(T).map(([t,o])=>React.createElement(e.Box,{key:t,sx:{mb:1}},React.createElement(e.Typography,{variant:"body2",gutterBottom:!0},t.charAt(0).toUpperCase()+t.slice(1),": ",o.label," (",Math.round(o.progress*100),"% complete)"),React.createElement(e.LinearProgress,{variant:"determinate",value:o.progress*100})))),((C=b.result)==null?void 0:C.message)&&!b.isExecuting&&React.createElement(e.Alert,{severity:"success",sx:{mt:2,mb:2}},b.result.message),l&&React.createElement(e.Box,{sx:{mt:2,mb:2}},React.createElement(e.Alert,{severity:"success",sx:{mb:2}},l.message),React.createElement(e.Typography,{variant:"h6",gutterBottom:!0},"Clustering Results"),React.createElement(e.Box,{sx:{display:"flex",gap:4,flexWrap:"wrap",mb:2}},React.createElement(e.Box,null,React.createElement(e.Typography,{variant:"body2",color:"text.secondary"},"Number of Clusters"),React.createElement(e.Typography,{variant:"h4",color:"primary"},l.num_clusters)),React.createElement(e.Box,null,React.createElement(e.Typography,{variant:"body2",color:"text.secondary"},"Total Objects"),React.createElement(e.Typography,{variant:"h4"},((_=l.labels)==null?void 0:_.length)||0)),l.labels&&React.createElement(e.Box,null,React.createElement(e.Typography,{variant:"body2",color:"text.secondary"},"Noise Points (Cluster -1)"),React.createElement(e.Typography,{variant:"h4",color:"error"},l.labels.filter(t=>t===-1).length))),l.labels&&React.createElement(e.Box,null,React.createElement(e.Typography,{variant:"body2",gutterBottom:!0},"Cluster Distribution:"),React.createElement(e.Box,{sx:{maxHeight:200,overflow:"auto"}},Object.entries(l.labels.reduce((t,o)=>(t[o]=(t[o]||0)+1,t),{})).sort(([t],[o])=>Number(t)-Number(o)).map(([t,o])=>React.createElement(e.Box,{key:t,sx:{display:"flex",justifyContent:"space-between",py:.5}},React.createElement(e.Typography,{variant:"body2"},"Cluster ",t==="-1"?"(Noise)":t,":"),React.createElement(e.Typography,{variant:"body2",fontWeight:"bold"},o," objects")))))),s&&React.createElement(React.Fragment,null,React.createElement(e.Typography,{variant:"h6",sx:{mt:2,mb:2}},"Annotated Objects (",R.length,")"),React.createElement(e.TableContainer,{component:e.Paper,sx:{maxHeight:400}},React.createElement(e.Table,{stickyHeader:!0,size:"small"},React.createElement(e.TableHead,null,React.createElement(e.TableRow,null,React.createElement(e.TableCell,null,"Sample ID"),React.createElement(e.TableCell,null,"Type"),React.createElement(e.TableCell,null,"Label"),React.createElement(e.TableCell,null,"Confidence"),React.createElement(e.TableCell,null,"Field"))),React.createElement(e.TableBody,null,R.map(t=>React.createElement(e.TableRow,{key:t.id},React.createElement(e.TableCell,null,t.sampleId),React.createElement(e.TableCell,null,t.type),React.createElement(e.TableCell,null,t.label),React.createElement(e.TableCell,null,t.confidence),React.createElement(e.TableCell,null,t.field)))))),R.length===0&&!d.isLoading&&React.createElement(e.Typography,{variant:"body2",color:"text.secondary",sx:{mt:2}},"No annotations found in the current dataset view.")))}class w extends a.Operator{get config(){return new a.OperatorConfig({name:"show_alert",label:"Show alert",unlisted:!0})}async execute(){alert(`Hello from plugin ${this.pluginName}`)}}a.registerOperator(w,"@bifrostai/cvcov"),n.registerComponent({name:"Bifrost CVCov",label:"Bifrost CVCov",component:j,type:n.PluginComponentType.Panel,activator:A,panelOptions:{surfaces:"grid modal",isNew:!0}});function A({dataset:s}){return!0}});
//# sourceMappingURL=index.umd.js.map
